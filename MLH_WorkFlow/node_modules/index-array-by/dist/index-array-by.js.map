{"version":3,"file":"index-array-by.js","sources":["../src/index.js"],"sourcesContent":["export default (list = [], keyAccessors = [], multiItem = true, flattenKeys = false) => {\n\n  const keys = (keyAccessors instanceof Array\n    ? (keyAccessors.length ? keyAccessors : [undefined])\n    : [keyAccessors]).map(key => ({\n    keyAccessor: key,\n    isProp: !(key instanceof Function)\n  }));\n\n  const indexedResult = list.reduce((res, item) => {\n    let iterObj = res;\n    let itemVal = item;\n\n    keys.forEach(({ keyAccessor, isProp }, idx) => {\n      let key;\n      if (isProp) {\n        const { [keyAccessor]: propVal, ...rest } = itemVal;\n        key = propVal;\n        itemVal = rest;\n      } else {\n        key = keyAccessor(itemVal, idx);\n      }\n\n      if (idx + 1 < keys.length) {\n        if (!iterObj.hasOwnProperty(key)) {\n          iterObj[key] = {};\n        }\n        iterObj = iterObj[key];\n      } else { // Leaf key\n        if (multiItem) {\n          if (!iterObj.hasOwnProperty(key)) {\n            iterObj[key] = [];\n          }\n          iterObj[key].push(itemVal);\n        } else {\n          iterObj[key] = itemVal;\n        }\n      }\n    });\n    return res;\n  }, {});\n\n  if (multiItem  instanceof Function) {\n    // Reduce leaf multiple values\n    (function reduce(node, level = 1) {\n      if (level === keys.length) {\n        Object.keys(node).forEach(k => node[k] = multiItem(node[k]));\n      } else {\n        Object.values(node).forEach(child => reduce(child, level + 1));\n      }\n    })(indexedResult); // IIFE\n  }\n\n  let result = indexedResult;\n\n  if (flattenKeys) {\n    // flatten into array\n    result = [];\n\n    (function flatten(node, accKeys = []) {\n      if (accKeys.length === keys.length) {\n        result.push({\n          keys: accKeys,\n          vals: node\n        });\n      } else {\n        Object.entries(node)\n          .forEach(([key, val]) => flatten(val, [...accKeys, key]));\n      }\n    })(indexedResult); //IIFE\n\n    if (keyAccessors instanceof Array && keyAccessors.length === 0 && result.length === 1) {\n      // clear keys if there's no key accessors (single result)\n      result[0].keys = [];\n    }\n  }\n\n  return result;\n}\n"],"names":["list","keyAccessors","multiItem","flattenKeys","keys","Array","length","undefined","map","key","keyAccessor","isProp","Function","indexedResult","reduce","res","item","iterObj","itemVal","forEach","idx","propVal","rest","hasOwnProperty","push","node","level","Object","k","values","child","result","flatten","accKeys","vals","entries","val"],"mappings":"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"}